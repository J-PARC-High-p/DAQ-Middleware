DESTDIR           =
WWW_DOCUMENT_ROOT = /var/www/html
DAQ_HTML_DIR      = $(DESTDIR)$(WWW_DOCUMENT_ROOT)/daqmw
INSTALL_DIR       = $(DAQ_HTML_DIR)/operatorPanel

INSTALL_FILES += _ParameterClient.so
INSTALL_FILES += operatorPanel0.html
INSTALL_FILES += ParameterClient.py
INSTALL_FILES += daq.py
INSTALL_FILES += writedata.py
INSTALL_FILES += runNumber.txt

SOCK_INC       = ../../src/lib/SiTCP/CPP/Sock
SOCK_LIB       = -L../../src/lib/SiTCP/CPP/Sock -lSock

SWIG           = /usr/bin/swig
SWIG_FLAGS     = -c++ -python
PYTHON_VERSION = 2.4
PYTHON_INC_DIR = /usr/include/python${PYTHON_VERSION}

IFILE          = ParameterClient
SRCS           = ${IFILE}.h
INTERFACE      = $(IFILE).i
WRAPFILE       = $(IFILE)_wrap.cxx
WRAPFILE_O     = $(IFILE)_wrap.o
SHAREDLIB      = _${IFILE}.so
CXX_FLAGS      = -c -fpic

all: ${SHAREDLIB}

${SHAREDLIB}: ${SRCS}
	${SWIG} ${SWIG_FLAGS} ${INTERFACE}
	${CXX} ${CXX_FLAGS} -I${SOCK_INC} -I${PYTHON_INC_DIR} ${WRAPFILE}
	${CXX} -shared ${WRAPFILE_O} ${SOCK_LIB} -o ${SHAREDLIB}

install:
	install -d -m 0755 $(INSTALL_DIR)
	install -m 0644 $(INSTALL_FILES) $(INSTALL_DIR)
	chmod 0666 $(INSTALL_DIR)/runNumber.txt

clean:
	rm -f ${IFILE}.py ${WRAPFILE} ${WRAPFILE_O} ${SHAREDLIB}

uninstall:
	@for file in $(INSTALL_FILES); do rm -f $(INSTALL_DIR)/$${file}; done
